[0m[32mTask[0m [0m[36mfbp-test[0m fbp-protocol/node_modules/.bin/_mocha fbp-protocol/test/*.js --reporter spec


  c9-fbp webSocket network runtime version 0.7.0
    Connecting to the runtime at ws://localhost:3569/
      "deno task runtime" starting
[0m[32mTask[0m [0m[36mruntime[0m deno run --unstable -A src/runtime.ts
Listening on http://localhost:3569/
      "deno task runtime" has started
      âœ“ should succeed (303ms)
    Runtime Protocol
      requesting runtime metadata
        âœ“ should provide it back
    Graph Protocol
      adding a graph and nodes
        âœ“ should provide the nodes back (44ms)
      adding an edge
{
  command: 'error',
  payload: { message: 'OutportNotFound' },
  protocol: 'graph'
}
        1) should provide the edge back
      adding metadata
        to a node with no metadata
          âœ“ should add the metadata
        to a node with existing metadata
          2) should merge the metadata
        with no keys to a node with existing metadata
          3) should not change the metadata
        with a null value removes it from the node
          4) should merge the metadata
      adding an IIP
{
  command: 'error',
  payload: { message: 'InportNotFound' },
  protocol: 'graph'
}
        5) should provide the IIP back
      removing a node
        6) should remove the node and its associated edges
      removing an IIP
{
  command: 'error',
  payload: { message: 'IIPNotFound' },
  protocol: 'graph'
}
{
  command: 'error',
  payload: { message: 'IIPNotFound' },
  protocol: 'graph'
}
        7) should provide response that iip was removed
      renaming a node
        âœ“ should send the renamenode event
      adding a node to a non-existent graph
        âœ“ should send an error
      adding a node without specifying a graph
Error: {"protocol":"graph","command":"addnode","payload":{"id":"Repeat1","component":"core/Repeat"}}: Encountered 94 transcode errors:
â”Œ at union member `{ command: getsource, payload: { name: string }, protocol: component } | { command: list, payload: {}, protocol: component } | { command: source, payload?: { code: string, language: string, library?: string?, name: string, tests?: string? }, protocol: component }`:
â”œâ”€â”€ at union member `{ command: getsource, payload: { name: string }, protocol: component }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected getsource but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key name:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€ at key protocol:
â”œâ”€â”€â”€â”€ Expected component but got "graph"
â”œâ”€â”€ at union member `{ command: list, payload: {}, protocol: component }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected list but got "addnode"
â”œâ”€â”€â”€ at key protocol:
â”œâ”€â”€â”€â”€ Expected component but got "graph"
â”œâ”€â”€ at union member `{ command: source, payload?: { code: string, language: string, library?: string?, name: string, tests?: string? }, protocol: component }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected source but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key code:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key language:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key name:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€ at key protocol:
â””â”€â”€â”€â”€ Expected component but got "graph"
â”Œ at union member `{ command: addedge, payload?: { graph: string, metadata?: { route?: Integer?, schema?: string?, secure?: boolean? }?, src: { node: string, port: string }, tgt: { node: string, port: string } }, protocol: graph } | { command: addgroup, payload?: { graph: string, metadata?: { description: string }?, name: string, nodes: Array<string> }, protocol: graph } | { command: addinitial, payload?: { graph: string, metadata?: { route?: Integer?, schema?: string?, secure?: boolean? }?, src?: { data?: null | Record<string, unknown> | Array<unknown> | string | Float | Integer | boolean? }, tgt: { node: string, port: string } }, protocol: graph } | { command: addinport, payload?: { graph: string, metadata?: Record<string, unknown>?, node: string, port: string, public: string }, protocol: graph } | { command: addnode, payload?: { component: string, graph: string, id: string, metadata?: Record<string, unknown>? }, protocol: graph } | { command: addoutport, payload?: { graph: string, metadata?: Record<string, unknown>?, node: string, port: string, public: string }, protocol: graph } | { command: changeedge, payload?: { graph: string, metadata?: { route?: Integer?, schema?: string?, secure?: boolean? }?, src: { node: string, port: string }, tgt: { node: string, port: string } }, protocol: graph } | { command: changegroup, payload?: { graph: string, metadata?: { description: string }?, name: string }, protocol: graph } | { command: changenode, payload: { graph: string, id: string, metadata: Record<string, unknown> }, protocol: graph } | { command: clear, payload?: { description?: string?, icon?: string?, id: string, library?: string?, main?: boolean?, name?: string? }, protocol: graph } | { command: error, payload: { message: string }, protocol: graph } | { command: removeedge, payload: { graph: string, src: { node: string, port: string }, tgt: { node: string, port: string } }, protocol: graph } | { command: removegroup, payload: { graph: string, name: string }, protocol: graph } | { command: removeinitial, payload?: { graph: string, src?: { data?: null | Record<string, unknown> | Array<unknown> | string | Float | Integer | boolean? }?, tgt: { node: string, port: string } }, protocol: graph } | { command: removeinport, payload: { graph: string, public: string }, protocol: graph } | { command: removenode, payload: { graph: string, id: string }, protocol: graph } | { command: removeoutport, payload: { graph: string, public: string }, protocol: graph } | { command: renamegroup, payload: { from: string, graph: string, to: string }, protocol: graph } | { command: renameinport, payload: { from: string, graph: string, to: string }, protocol: graph } | { command: renamenode, payload: { from: string, graph: string, to: string }, protocol: graph } | { command: renameoutport, payload: { from: string, graph: string, to: string }, protocol: graph }`:
â”œâ”€â”€ at union member `{ command: addedge, payload?: { graph: string, metadata?: { route?: Integer?, schema?: string?, secure?: boolean? }?, src: { node: string, port: string }, tgt: { node: string, port: string } }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected addedge but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key src:
â”œâ”€â”€â”€â”€â”€ Expected { node: string, port: string } but got undefined
â”œâ”€â”€â”€â”€ at key tgt:
â”œâ”€â”€â”€â”€â”€ Expected { node: string, port: string } but got undefined
â”œâ”€â”€ at union member `{ command: addgroup, payload?: { graph: string, metadata?: { description: string }?, name: string, nodes: Array<string> }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected addgroup but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key name:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key nodes:
â”œâ”€â”€â”€â”€â”€ Expected Array<string> but got undefined
â”œâ”€â”€ at union member `{ command: addinitial, payload?: { graph: string, metadata?: { route?: Integer?, schema?: string?, secure?: boolean? }?, src?: { data?: null | Record<string, unknown> | Array<unknown> | string | Float | Integer | boolean? }, tgt: { node: string, port: string } }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected addinitial but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key src:
â”œâ”€â”€â”€â”€â”€ Expected { data?: null | Record<string, unknown> | Array<unknown> | string | Float | Integer | boolean? } but got undefined
â”œâ”€â”€â”€â”€ at key tgt:
â”œâ”€â”€â”€â”€â”€ Expected { node: string, port: string } but got undefined
â”œâ”€â”€ at union member `{ command: addinport, payload?: { graph: string, metadata?: Record<string, unknown>?, node: string, port: string, public: string }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected addinport but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key node:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key port:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key public:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€ at union member `{ command: addnode, payload?: { component: string, graph: string, id: string, metadata?: Record<string, unknown>? }, protocol: graph }`:
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€ at union member `{ command: addoutport, payload?: { graph: string, metadata?: Record<string, unknown>?, node: string, port: string, public: string }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected addoutport but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key node:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key port:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key public:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€ at union member `{ command: changeedge, payload?: { graph: string, metadata?: { route?: Integer?, schema?: string?, secure?: boolean? }?, src: { node: string, port: string }, tgt: { node: string, port: string } }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected changeedge but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key src:
â”œâ”€â”€â”€â”€â”€ Expected { node: string, port: string } but got undefined
â”œâ”€â”€â”€â”€ at key tgt:
â”œâ”€â”€â”€â”€â”€ Expected { node: string, port: string } but got undefined
â”œâ”€â”€ at union member `{ command: changegroup, payload?: { graph: string, metadata?: { description: string }?, name: string }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected changegroup but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key name:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€ at union member `{ command: changenode, payload: { graph: string, id: string, metadata: Record<string, unknown> }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected changenode but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key metadata:
â”œâ”€â”€â”€â”€â”€ Expected Record<string, unknown> but got undefined
â”œâ”€â”€ at union member `{ command: clear, payload?: { description?: string?, icon?: string?, id: string, library?: string?, main?: boolean?, name?: string? }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected clear but got "addnode"
â”œâ”€â”€ at union member `{ command: error, payload: { message: string }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected error but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key message:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€ at union member `{ command: removeedge, payload: { graph: string, src: { node: string, port: string }, tgt: { node: string, port: string } }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected removeedge but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key src:
â”œâ”€â”€â”€â”€â”€ Expected { node: string, port: string } but got undefined
â”œâ”€â”€â”€â”€ at key tgt:
â”œâ”€â”€â”€â”€â”€ Expected { node: string, port: string } but got undefined
â”œâ”€â”€ at union member `{ command: removegroup, payload: { graph: string, name: string }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected removegroup but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key name:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€ at union member `{ command: removeinitial, payload?: { graph: string, src?: { data?: null | Record<string, unknown> | Array<unknown> | string | Float | Integer | boolean? }?, tgt: { node: string, port: string } }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected removeinitial but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key tgt:
â”œâ”€â”€â”€â”€â”€ Expected { node: string, port: string } but got undefined
â”œâ”€â”€ at union member `{ command: removeinport, payload: { graph: string, public: string }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected removeinport but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key public:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€ at union member `{ command: removenode, payload: { graph: string, id: string }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected removenode but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€ at union member `{ command: removeoutport, payload: { graph: string, public: string }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected removeoutport but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key public:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€ at union member `{ command: renamegroup, payload: { from: string, graph: string, to: string }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected renamegroup but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key from:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key to:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€ at union member `{ command: renameinport, payload: { from: string, graph: string, to: string }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected renameinport but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key from:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key to:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€ at union member `{ command: renamenode, payload: { from: string, graph: string, to: string }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected renamenode but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key from:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key to:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€ at union member `{ command: renameoutport, payload: { from: string, graph: string, to: string }, protocol: graph }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected renameoutport but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key from:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key to:
â””â”€â”€â”€â”€â”€ Expected string but got undefined
â”Œ at union member `{ command: getruntime, payload?: { secret?: string? }, protocol: runtime } | { command: packet, payload: { event: connect | begingroup | data | endgroup | disconnect, graph: string, payload: {}, port: string, schema: string, type: string }, protocol: runtime }`:
â”œâ”€â”€ at union member `{ command: getruntime, payload?: { secret?: string? }, protocol: runtime }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected getruntime but got "addnode"
â”œâ”€â”€â”€ at key protocol:
â”œâ”€â”€â”€â”€ Expected runtime but got "graph"
â”œâ”€â”€ at union member `{ command: packet, payload: { event: connect | begingroup | data | endgroup | disconnect, graph: string, payload: {}, port: string, schema: string, type: string }, protocol: runtime }`:
â”œâ”€â”€â”€ at key command:
â”œâ”€â”€â”€â”€ Expected packet but got "addnode"
â”œâ”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€ at key event:
â”œâ”€â”€â”€â”€â”€ at union member `0`:
â”œâ”€â”€â”€â”€â”€â”€ Expected connect but got undefined
â”œâ”€â”€â”€â”€â”€ at union member `1`:
â”œâ”€â”€â”€â”€â”€â”€ Expected begingroup but got undefined
â”œâ”€â”€â”€â”€â”€ at union member `2`:
â”œâ”€â”€â”€â”€â”€â”€ Expected data but got undefined
â”œâ”€â”€â”€â”€â”€ at union member `3`:
â”œâ”€â”€â”€â”€â”€â”€ Expected endgroup but got undefined
â”œâ”€â”€â”€â”€â”€ at union member `4`:
â”œâ”€â”€â”€â”€â”€â”€ Expected disconnect but got undefined
â”œâ”€â”€â”€â”€ at key graph:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key payload:
â”œâ”€â”€â”€â”€â”€ Expected {} but got undefined
â”œâ”€â”€â”€â”€ at key port:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key schema:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€â”€ at key type:
â”œâ”€â”€â”€â”€â”€ Expected string but got undefined
â”œâ”€â”€â”€ at key protocol:
â””â”€â”€â”€â”€ Expected runtime but got "graph"
    at transcodeErrorGraph (file:///home/tom/Code/code9/deno/c9-fbp/src/server.ts:48:10)
    at file:///home/tom/Code/code9/deno/c9-fbp/src/server.ts:58:14
    at https://deno.land/x/fp_ts@v2.11.4/Either.ts:619:21
    at pipe (https://deno.land/x/fp_ts@v2.11.4/function.ts:660:14)
    at decodeInputMessage (file:///home/tom/Code/code9/deno/c9-fbp/src/server.ts:52:10)
    at https://deno.land/x/fp_ts@v2.11.4/Either.ts:341:27
    at pipe (https://deno.land/x/fp_ts@v2.11.4/function.ts:668:22)
    at parseInputMessage (file:///home/tom/Code/code9/deno/c9-fbp/src/server.ts:64:10)
    at https://deno.land/x/fp_ts@v2.11.4/EitherT.ts:183:69
    at https://deno.land/x/fp_ts@v2.11.4/Task.ts:149:18
        8) should send an error
      adding an in-port to a graph
        âœ“ should ACK
      adding an out-port to a graph
        âœ“ should ACK
      removing an out-port of a graph
        âœ“ should ACK
    Network Protocol
      9) "before all" hook in "Network Protocol"
    Component Protocol
      on requesting a component list
        10) "before all" hook in "Network Protocol"
        11) should receive some known components
    12) "after all" hook in "c9-fbp webSocket network runtime version 0.7.0"


  9 passing (26s)
  12 failing

  1) c9-fbp webSocket network runtime version 0.7.0
       Graph Protocol
         adding an edge
           should provide the edge back:
     Error: done() invoked with non-Error: {"message":"OutportNotFound"}
      at WebSocketConnection.listener (fbp-protocol/src/WebSocket.js:113:11)
      at Object.onceWrapper (node:events:629:26)
      at WebSocketConnection.emit (node:events:514:28)
      at WebSocketConnection.processFrame (fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:554:26)
      at /home/tom/Code/code9/deno/c9-fbp/fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:323:40
      at process.processTicksAndRejections (node:internal/process/task_queues:77:11)

  2) c9-fbp webSocket network runtime version 0.7.0
       Graph Protocol
         adding metadata
           to a node with existing metadata
             should merge the metadata:

      Uncaught AssertionError: expected { graph: 'foo', id: 'Drop1', â€¦(1) } to deeply equal { id: 'Drop1', â€¦(2) }
      + expected - actual

       {
         "graph": "foo"
         "id": "Drop1"
         "metadata": {
      +    "sort": 1
           "tag": "awesome"
         }
       }
      
      at WebSocketConnection.listener (fbp-protocol/src/WebSocket.js:153:38)
      at Object.onceWrapper (node:events:629:26)
      at WebSocketConnection.emit (node:events:514:28)
      at WebSocketConnection.processFrame (fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:554:26)
      at /home/tom/Code/code9/deno/c9-fbp/fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:323:40
      at process.processTicksAndRejections (node:internal/process/task_queues:77:11)

  3) c9-fbp webSocket network runtime version 0.7.0
       Graph Protocol
         adding metadata
           with no keys to a node with existing metadata
             should not change the metadata:

      Uncaught AssertionError: expected { graph: 'foo', id: 'Drop1', â€¦(1) } to deeply equal { id: 'Drop1', â€¦(2) }
      + expected - actual

       {
         "graph": "foo"
         "id": "Drop1"
      -  "metadata": {}
      +  "metadata": {
      +    "sort": 1
      +    "tag": "awesome"
      +  }
       }
      
      at WebSocketConnection.listener (fbp-protocol/src/WebSocket.js:153:38)
      at Object.onceWrapper (node:events:629:26)
      at WebSocketConnection.emit (node:events:514:28)
      at WebSocketConnection.processFrame (fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:554:26)
      at /home/tom/Code/code9/deno/c9-fbp/fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:323:40
      at process.processTicksAndRejections (node:internal/process/task_queues:77:11)

  4) c9-fbp webSocket network runtime version 0.7.0
       Graph Protocol
         adding metadata
           with a null value removes it from the node
             should merge the metadata:

      Uncaught AssertionError: expected { graph: 'foo', id: 'Drop1', â€¦(1) } to deeply equal { id: 'Drop1', metadata: {}, â€¦(1) }
      + expected - actual

       {
         "graph": "foo"
         "id": "Drop1"
      -  "metadata": {
      -    "sort": [null]
      -    "tag": [null]
      -  }
      +  "metadata": {}
       }
      
      at WebSocketConnection.listener (fbp-protocol/src/WebSocket.js:153:38)
      at Object.onceWrapper (node:events:629:26)
      at WebSocketConnection.emit (node:events:514:28)
      at WebSocketConnection.processFrame (fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:554:26)
      at /home/tom/Code/code9/deno/c9-fbp/fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:323:40
      at process.processTicksAndRejections (node:internal/process/task_queues:77:11)

  5) c9-fbp webSocket network runtime version 0.7.0
       Graph Protocol
         adding an IIP
           should provide the IIP back:
     Error: done() invoked with non-Error: {"message":"InportNotFound"}
      at WebSocketConnection.listener (fbp-protocol/src/WebSocket.js:113:11)
      at Object.onceWrapper (node:events:629:26)
      at WebSocketConnection.emit (node:events:514:28)
      at WebSocketConnection.processFrame (fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:554:26)
      at /home/tom/Code/code9/deno/c9-fbp/fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:323:40
      at process.processTicksAndRejections (node:internal/process/task_queues:77:11)

  6) c9-fbp webSocket network runtime version 0.7.0
       Graph Protocol
         removing a node
           should remove the node and its associated edges:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves. (/home/tom/Code/code9/deno/c9-fbp/fbp-protocol/test/TestWebSocket.js)
      at listOnTimeout (node:internal/timers:573:17)
      at process.processTimers (node:internal/timers:514:7)

  7) c9-fbp webSocket network runtime version 0.7.0
       Graph Protocol
         removing an IIP
           should provide response that iip was removed:
     Error: done() invoked with non-Error: {"message":"IIPNotFound"}
      at WebSocketConnection.listener (fbp-protocol/src/WebSocket.js:113:11)
      at Object.onceWrapper (node:events:629:26)
      at WebSocketConnection.emit (node:events:526:35)
      at WebSocketConnection.processFrame (fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:554:26)
      at /home/tom/Code/code9/deno/c9-fbp/fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:323:40
      at process.processTicksAndRejections (node:internal/process/task_queues:77:11)

  8) c9-fbp webSocket network runtime version 0.7.0
       Graph Protocol
         adding a node without specifying a graph
           should send an error:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves. (/home/tom/Code/code9/deno/c9-fbp/fbp-protocol/test/TestWebSocket.js)
      at listOnTimeout (node:internal/timers:573:17)
      at process.processTimers (node:internal/timers:514:7)

  9) c9-fbp webSocket network runtime version 0.7.0
       Network Protocol
         "before all" hook in "Network Protocol":

      Uncaught AssertionError: expected { message: 'NodeNotFound' } to deeply equal { message: 'No graph specified' }
      + expected - actual

       {
      -  "message": "NodeNotFound"
      +  "message": "No graph specified"
       }
      
      at WebSocketConnection.listener (fbp-protocol/src/WebSocket.js:153:38)
      at Object.onceWrapper (node:events:629:26)
      at WebSocketConnection.emit (node:events:526:35)
      at WebSocketConnection.processFrame (fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:554:26)
      at /home/tom/Code/code9/deno/c9-fbp/fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:323:40
      at process.processTicksAndRejections (node:internal/process/task_queues:77:11)

  10) c9-fbp webSocket network runtime version 0.7.0
       Network Protocol
         "before all" hook in "Network Protocol":
     Error: done() called multiple times in hook <c9-fbp webSocket network runtime version 0.7.0 Network Protocol "before all" hook in "Network Protocol"> of file /home/tom/Code/code9/deno/c9-fbp/fbp-protocol/test/TestWebSocket.js
      at WebSocketConnection.listener (fbp-protocol/src/WebSocket.js:635:11)
      at Object.onceWrapper (node:events:629:26)
      at WebSocketConnection.emit (node:events:526:35)
      at WebSocketConnection.processFrame (fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:554:26)
      at /home/tom/Code/code9/deno/c9-fbp/fbp-protocol/node_modules/.pnpm/websocket@1.0.34/node_modules/websocket/lib/WebSocketConnection.js:323:40
      at process.processTicksAndRejections (node:internal/process/task_queues:77:11)

  11) c9-fbp webSocket network runtime version 0.7.0
       Component Protocol
         on requesting a component list
           should receive some known components:
     Error: Timeout of 20000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves. (/home/tom/Code/code9/deno/c9-fbp/fbp-protocol/test/TestWebSocket.js)
      at listOnTimeout (node:internal/timers:573:17)
      at process.processTimers (node:internal/timers:514:7)

  12) c9-fbp webSocket network runtime version 0.7.0
       "after all" hook in "c9-fbp webSocket network runtime version 0.7.0":
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves. (/home/tom/Code/code9/deno/c9-fbp/fbp-protocol/test/TestWebSocket.js)
      at listOnTimeout (node:internal/timers:573:17)
      at process.processTimers (node:internal/timers:514:7)



